# =============================================================================
# 안전성 최우선 코인 자동거래 시스템 - 환경 설정
# =============================================================================

# ------------------------------------------------------------------------------
# 운영 모드 (CRITICAL: 기본값은 반드시 'paper')
# ------------------------------------------------------------------------------
# 'paper': 모의투자 (기본값, 안전)
# 'live': 실거래 (2단계 확인 필요, 위험)
TRADING_MODE=paper

# ------------------------------------------------------------------------------
# Live Mode Gate (실거래 전환 시 2단계 확인)
# ------------------------------------------------------------------------------
# TRADING_MODE=live로 설정했더라도, 아래 토큰이 없으면 실거래 불가
# 토큰 파일 경로 (예: RUN/live_mode_token.txt)
# 내용: 짧은 TTL을 가진 UUID 또는 타임스탬프
LIVE_MODE_TOKEN_PATH=RUN/live_mode_token.txt

# ------------------------------------------------------------------------------
# 거래소 선택 (업비트, 바이낸스, 또는 둘 다)
# ------------------------------------------------------------------------------
# 사용할 거래소 (쉼표로 구분): upbit, binance
ENABLED_EXCHANGES=upbit

# ------------------------------------------------------------------------------
# 업비트 API 인증 (암호화 저장 권장)
# ------------------------------------------------------------------------------
# API 키 파일 경로 (암호화된 형태로 저장)
UPBIT_KEY_FILE=data/upbit_keys.enc
# 마스터 키 (환경변수로만 주입, 파일 저장 금지)
UPBIT_MASTER_KEY=

# ------------------------------------------------------------------------------
# 바이낸스 API 인증 (암호화 저장 권장)
# ------------------------------------------------------------------------------
BINANCE_KEY_FILE=data/binance_keys.enc
BINANCE_MASTER_KEY=

# ------------------------------------------------------------------------------
# 리스크 관리 하드코딩 상수 (안전장치)
# ------------------------------------------------------------------------------
# 1회 주문 최대 비중 (총 자산 대비 %, 예: 10 = 10%)
MAX_POSITION_SIZE_PCT=10
# 최대 포지션 수 (동시에 보유 가능한 코인 종류)
MAX_POSITIONS=10
# 1일 최대 손실 한도 (%, 예: 5 = 5%)
DAILY_MAX_DRAWDOWN_PCT=5
# 손절 비율 (%, 예: -3 = -3%)
STOP_LOSS_PCT=-3
# 익절 비율 (%, 예: 10 = 10%)
TAKE_PROFIT_PCT=10
# 트레일링 스탑 활성화 (true/false)
TRAILING_STOP_ENABLED=true
# 트레일링 스탑 비율 (%, 예: 5 = 최고점 대비 -5%에서 매도)
TRAILING_STOP_PCT=5

# ------------------------------------------------------------------------------
# 서킷브레이커 (가격 급변 시 거래 중단)
# ------------------------------------------------------------------------------
# 짧은 구간 변동률 임계값 (%, 예: 15 = 15% 급변 시 중단)
CIRCUIT_BREAKER_THRESHOLD_PCT=15
# 변동률 측정 기간 (분)
CIRCUIT_BREAKER_WINDOW_MIN=5

# ------------------------------------------------------------------------------
# 주문 제한 (시장가 남발 방지, 레이트 리밋)
# ------------------------------------------------------------------------------
# 기본 주문 타입 (limit: 지정가, market: 시장가)
DEFAULT_ORDER_TYPE=limit
# 최대 주문 빈도 (초당 최대 주문 수)
MAX_ORDERS_PER_SECOND=1

# ------------------------------------------------------------------------------
# 레버리지/선물 (기본 OFF)
# ------------------------------------------------------------------------------
# 선물 거래 활성화 (false 권장)
FUTURES_ENABLED=false
# 레버리지 배수 (1 = 현물만)
MAX_LEVERAGE=1

# ------------------------------------------------------------------------------
# 이상 징후 감지
# ------------------------------------------------------------------------------
# API 연속 실패 임계값 (N회 연속 실패 시 soft stop)
API_FAILURE_THRESHOLD=5
# 잔고 불일치 허용 오차 (%, 예: 0.1 = 0.1%)
BALANCE_MISMATCH_TOLERANCE_PCT=0.1

# ------------------------------------------------------------------------------
# 로깅
# ------------------------------------------------------------------------------
# 로그 레벨 (DEBUG, INFO, WARNING, ERROR)
LOG_LEVEL=INFO
# 로그 디렉토리
LOG_DIR=logs

# ------------------------------------------------------------------------------
# 데이터베이스 (PostgreSQL)
# ------------------------------------------------------------------------------
DATABASE_URL=postgresql://trader:trader@localhost:5432/coin_trader
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=10

# ------------------------------------------------------------------------------
# Kill Switch (선택 옵션)
# ------------------------------------------------------------------------------
# Kill switch 파일 경로
KILL_SWITCH_FILE=RUN/kill_switch
# Kill switch HTTP 포트 (로컬 전용, 0 = 비활성화)
KILL_SWITCH_HTTP_PORT=8765

# ------------------------------------------------------------------------------
# 전략 설정
# ------------------------------------------------------------------------------
# 사용할 전략 (technical, momentum, volatility)
STRATEGY_TYPE=technical
# 거래 심볼 (JSON 배열 형식, 예: ["BTC/KRW","ETH/KRW"])
TRADING_SYMBOLS=["BTC/KRW","ETH/KRW"]
# 시장 데이터 갱신 주기 (초) — 120초 권장 (API 429 방지)
MARKET_DATA_INTERVAL_SEC=120
CANDLE_REFRESH_INTERVAL_SEC=3600
DYNAMIC_SYMBOL_SELECTION_ENABLED=true
DYNAMIC_SYMBOL_REFRESH_SEC=3600
DYNAMIC_SYMBOL_TOP_K=5
DYNAMIC_SYMBOL_MAX_SYMBOLS=10
DYNAMIC_SYMBOL_MIN_KRW_24H=1000000000
DYNAMIC_SYMBOL_BATCH_SIZE=80
DYNAMIC_SYMBOL_MAX_SPREAD_BPS=80
DYNAMIC_SYMBOL_MAX_ABS_CHANGE_24H_PCT=20
DYNAMIC_SYMBOL_MAX_INTRADAY_RANGE_PCT=30
ALWAYS_KEEP_SYMBOLS=BTC/KRW,ETH/KRW

# ------------------------------------------------------------------------------
# 알림 (선택 사항)
# ------------------------------------------------------------------------------
# 슬랙 웹훅 URL (이상 징후 알림용)
SLACK_WEBHOOK_URL=
# 이메일 알림 (향후 구현)
EMAIL_ALERTS_ENABLED=false

# ------------------------------------------------------------------------------
# LLM Advisory (선택 사항)
# ------------------------------------------------------------------------------
# LLM 활성화 (false = 순수 기술적 분석만 사용)
LLM_ENABLED=false
# 인증 방식: api_key (기존 OpenAI/Anthropic API 키) 또는 oauth (OpenAI OAuth)
LLM_AUTH_MODE=api_key

# --- API Key 방식 (LLM_AUTH_MODE=api_key) ---
# LLM 제공자 (openai, anthropic)
LLM_PROVIDER=openai
# API 키 (환경변수로만 주입, 파일 저장 금지)
LLM_API_KEY=
# 모델명
LLM_MODEL=gpt-4o-mini

# --- OAuth 방식 (LLM_AUTH_MODE=oauth) ---
# OAuth 토큰 저장 파일 (git에 커밋하지 마세요)
LLM_OAUTH_AUTH_FILE=data/.auth/openai-oauth.json
# 사용할 모델 (gpt-5.2-codex, gpt-5.1-codex, gpt-5.1-codex-mini 등)
LLM_OAUTH_MODEL=gpt-5.2-codex
# 브라우저 로그인 허용 (헤드리스 서버는 false)
LLM_OAUTH_OPEN_BROWSER=true
# 강제 재로그인 (기존 세션 무시)
LLM_OAUTH_FORCE_LOGIN=false

# --- LLM 거래 연동 ---
LLM_TRADING_ENABLED=false
LLM_MIN_CONFIDENCE=0.65
LLM_RECENT_CANDLES_COUNT=24
LLM_RECENT_ORDERS_COUNT=10

# soft 손절 비율 (%, -5%~-10% 구간에서 LLM에게 질의)
SOFT_STOP_LOSS_PCT=5

# 미체결 주문 자동 취소 (초, 기본 300 = 5분)
STALE_ORDER_TIMEOUT_SEC=300

# ------------------------------------------------------------------------------
# 웹 대시보드 인증 (비어있으면 인증 없이 접근 가능)
# ------------------------------------------------------------------------------
WEB_MASTER_CODE=
